"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _chai = _interopRequireDefault(require("chai"));

var _chaiAsPromised = _interopRequireDefault(require("chai-as-promised"));

var _utils = require("../lib/utils");

var _helpers = require("./helpers");

var _lodash = _interopRequireDefault(require("lodash"));

const should = _chai.default.should();

_chai.default.use(_chaiAsPromised.default);

describe('utils', function () {
  describe('parseCapsForInnerDriver()', function () {
    it('should return JSONWP caps unchanged if only JSONWP caps provided', function () {
      let {
        desiredCaps,
        processedJsonwpCapabilities,
        processedW3CCapabilities,
        protocol
      } = (0, _utils.parseCapsForInnerDriver)(_helpers.BASE_CAPS);
      desiredCaps.should.deep.equal(_helpers.BASE_CAPS);
      processedJsonwpCapabilities.should.deep.equal(_helpers.BASE_CAPS);
      should.not.exist(processedW3CCapabilities);
      protocol.should.equal('MJSONWP');
    });
    it('should return W3C caps unchanged if only W3C caps were provided', function () {
      let {
        desiredCaps,
        processedJsonwpCapabilities,
        processedW3CCapabilities,
        protocol
      } = (0, _utils.parseCapsForInnerDriver)(undefined, _helpers.W3C_CAPS);
      desiredCaps.should.deep.equal(_helpers.BASE_CAPS);
      should.not.exist(processedJsonwpCapabilities);
      processedW3CCapabilities.should.deep.equal(_helpers.W3C_CAPS);
      protocol.should.equal('W3C');
    });
    it('should return JSONWP and W3C caps if both were provided', function () {
      let {
        desiredCaps,
        processedJsonwpCapabilities,
        processedW3CCapabilities,
        protocol
      } = (0, _utils.parseCapsForInnerDriver)(_helpers.BASE_CAPS, _helpers.W3C_CAPS);
      desiredCaps.should.deep.equal(_helpers.BASE_CAPS);
      processedJsonwpCapabilities.should.deep.equal(_helpers.BASE_CAPS);
      processedW3CCapabilities.should.deep.equal(_helpers.W3C_CAPS);
      protocol.should.equal('W3C');
    });
    it('should include default capabilities in results', function () {
      let {
        desiredCaps,
        processedJsonwpCapabilities,
        processedW3CCapabilities
      } = (0, _utils.parseCapsForInnerDriver)(_helpers.BASE_CAPS, _helpers.W3C_CAPS, {}, {
        foo: 'bar'
      });
      desiredCaps.should.deep.equal({
        foo: 'bar',
        ..._helpers.BASE_CAPS
      });
      processedJsonwpCapabilities.should.deep.equal({
        foo: 'bar',
        ..._helpers.BASE_CAPS
      });
      processedW3CCapabilities.alwaysMatch.should.deep.equal({
        'appium:foo': 'bar',
        ...(0, _utils.insertAppiumPrefixes)(_helpers.BASE_CAPS)
      });
    });
    it('should rewrite default capabilities in results', function () {
      const baseCapsWithDefault = Object.assign({}, _helpers.BASE_CAPS, {
        foo: 'baz',
        'appium:foo2': 'baz2'
      });

      const w3cCapsWithDefault = _lodash.default.cloneDeep(_helpers.W3C_CAPS);

      w3cCapsWithDefault.alwaysMatch.foo = 'baz';
      w3cCapsWithDefault.alwaysMatch.foo2 = 'baz2';
      let {
        desiredCaps,
        processedJsonwpCapabilities,
        processedW3CCapabilities
      } = (0, _utils.parseCapsForInnerDriver)(baseCapsWithDefault, w3cCapsWithDefault, {}, {
        foo: 'bar',
        'appium:foo2': 'bar2'
      });
      desiredCaps.should.deep.equal({
        foo: 'baz',
        foo2: 'baz2',
        ..._helpers.BASE_CAPS
      });
      processedJsonwpCapabilities.should.deep.equal({
        foo: 'baz',
        foo2: 'baz2',
        ..._helpers.BASE_CAPS
      });
      processedW3CCapabilities.alwaysMatch.should.deep.equal({
        'appium:foo': 'baz',
        'appium:foo2': 'baz2',
        ...(0, _utils.insertAppiumPrefixes)(_helpers.BASE_CAPS)
      });
    });
    it('should reject if W3C caps are not passing constraints', function () {
      const err = (0, _utils.parseCapsForInnerDriver)(undefined, _helpers.W3C_CAPS, {
        hello: {
          presence: true
        }
      }).error;
      err.message.should.match(/'hello' can't be blank/);
      _lodash.default.isError(err).should.be.true;
    });
    it('should only accept W3C caps that have passing constraints', function () {
      let w3cCaps = { ..._helpers.W3C_CAPS,
        firstMatch: [{
          foo: 'bar'
        }, {
          hello: 'world'
        }]
      };
      let {
        desiredCaps,
        processedJsonwpCapabilities,
        processedW3CCapabilities,
        protocol
      } = (0, _utils.parseCapsForInnerDriver)(_helpers.BASE_CAPS, w3cCaps, {
        hello: {
          presence: true
        }
      });
      const expectedResult = {
        hello: 'world',
        ..._helpers.BASE_CAPS
      };
      desiredCaps.should.deep.equal(expectedResult);
      processedJsonwpCapabilities.should.deep.equal({ ..._helpers.BASE_CAPS
      });
      processedW3CCapabilities.alwaysMatch.should.deep.equal((0, _utils.insertAppiumPrefixes)(expectedResult));
      protocol.should.equal('W3C');
    });
    it('should add appium prefixes to W3C caps that are not standard in W3C', function () {
      (0, _utils.parseCapsForInnerDriver)(undefined, {
        alwaysMatch: {
          platformName: 'Fake',
          propertyName: 'PROP_NAME'
        }
      }).processedW3CCapabilities.should.deep.equal({
        alwaysMatch: {
          platformName: 'Fake',
          'appium:propertyName': 'PROP_NAME'
        },
        firstMatch: [{}]
      });
    });
    it('should merge extraneous MJSONWP caps into W3C', function () {
      let jsonwpCaps = { ..._helpers.BASE_CAPS,
        automationName: 'Fake'
      };
      const {
        desiredCaps,
        processedJsonwpCapabilities,
        processedW3CCapabilities,
        protocol
      } = (0, _utils.parseCapsForInnerDriver)(jsonwpCaps, {
        alwaysMatch: {
          platformName: 'Fake',
          propertyName: 'PROP_NAME'
        }
      });
      const expectedCaps = {};

      for (let [key, value] of _lodash.default.toPairs(jsonwpCaps)) {
        if (key !== 'platformName') {
          expectedCaps[`appium:${key}`] = value;
        } else {
          expectedCaps[key] = value;
        }
      }

      expectedCaps['appium:propertyName'] = 'PROP_NAME';
      processedW3CCapabilities.alwaysMatch.should.eql(expectedCaps);
      desiredCaps.should.eql({ ...jsonwpCaps,
        propertyName: 'PROP_NAME'
      });
      processedJsonwpCapabilities.should.eql(jsonwpCaps);
      protocol.should.equal('W3C');
    });
    it('should fix W3C caps by using MJSONWP if invalid W3C caps were provided', function () {
      let w3cCapabilities = {
        alwaysMatch: {
          platformName: 'Fake',
          propertyName: 'PROP_NAME'
        }
      };
      let constraints = {
        deviceName: {
          presence: true
        }
      };
      const {
        desiredCaps,
        processedJsonwpCapabilities,
        processedW3CCapabilities,
        protocol
      } = (0, _utils.parseCapsForInnerDriver)({ ..._helpers.BASE_CAPS
      }, w3cCapabilities, constraints);
      processedW3CCapabilities.should.exist;
      desiredCaps.should.eql({ ..._helpers.BASE_CAPS,
        propertyName: 'PROP_NAME'
      });
      processedJsonwpCapabilities.should.eql(_helpers.BASE_CAPS);
      protocol.should.equal('W3C');
    });
  });
  describe('insertAppiumPrefixes()', function () {
    it('should apply prefixes to non-standard capabilities', function () {
      (0, _utils.insertAppiumPrefixes)({
        someCap: 'someCap'
      }).should.deep.equal({
        'appium:someCap': 'someCap'
      });
    });
    it('should not apply prefixes to standard capabilities', function () {
      (0, _utils.insertAppiumPrefixes)({
        browserName: 'BrowserName',
        platformName: 'PlatformName'
      }).should.deep.equal({
        browserName: 'BrowserName',
        platformName: 'PlatformName'
      });
    });
    it('should not apply prefixes to capabilities that already have a prefix', function () {
      (0, _utils.insertAppiumPrefixes)({
        'appium:someCap': 'someCap',
        'moz:someOtherCap': 'someOtherCap'
      }).should.deep.equal({
        'appium:someCap': 'someCap',
        'moz:someOtherCap': 'someOtherCap'
      });
    });
    it('should apply prefixes to non-prefixed, non-standard capabilities; should not apply prefixes to any other capabilities', function () {
      (0, _utils.insertAppiumPrefixes)({
        'appium:someCap': 'someCap',
        'moz:someOtherCap': 'someOtherCap',
        browserName: 'BrowserName',
        platformName: 'PlatformName',
        someOtherCap: 'someOtherCap',
        yetAnotherCap: 'yetAnotherCap'
      }).should.deep.equal({
        'appium:someCap': 'someCap',
        'moz:someOtherCap': 'someOtherCap',
        browserName: 'BrowserName',
        platformName: 'PlatformName',
        'appium:someOtherCap': 'someOtherCap',
        'appium:yetAnotherCap': 'yetAnotherCap'
      });
    });
  });
  describe('pullSettings()', function () {
    it('should pull settings from caps', function () {
      const caps = {
        platformName: 'foo',
        browserName: 'bar',
        'settings[settingName]': 'baz',
        'settings[settingName2]': 'baz2'
      };
      const settings = (0, _utils.pullSettings)(caps);
      settings.should.eql({
        settingName: 'baz',
        settingName2: 'baz2'
      });
      caps.should.eql({
        platformName: 'foo',
        browserName: 'bar'
      });
    });
    it('should pull settings dict if object values are present in caps', function () {
      const caps = {
        platformName: 'foo',
        browserName: 'bar',
        'settings[settingName]': {
          key: 'baz'
        }
      };
      const settings = (0, _utils.pullSettings)(caps);
      settings.should.eql({
        settingName: {
          key: 'baz'
        }
      });
      caps.should.eql({
        platformName: 'foo',
        browserName: 'bar'
      });
    });
    it('should pull empty dict if no settings are present in caps', function () {
      const caps = {
        platformName: 'foo',
        browserName: 'bar',
        'setting[settingName]': 'baz'
      };
      const settings = (0, _utils.pullSettings)(caps);
      settings.should.eql({});
      caps.should.eql({
        platformName: 'foo',
        browserName: 'bar',
        'setting[settingName]': 'baz'
      });
    });
    it('should pull empty dict if caps are empty', function () {
      const caps = {};
      const settings = (0, _utils.pullSettings)(caps);
      settings.should.eql({});
      caps.should.eql({});
    });
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdXRpbHMtc3BlY3MuanMiXSwibmFtZXMiOlsic2hvdWxkIiwiY2hhaSIsInVzZSIsImNoYWlBc1Byb21pc2VkIiwiZGVzY3JpYmUiLCJpdCIsImRlc2lyZWRDYXBzIiwicHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzIiwicHJvY2Vzc2VkVzNDQ2FwYWJpbGl0aWVzIiwicHJvdG9jb2wiLCJCQVNFX0NBUFMiLCJkZWVwIiwiZXF1YWwiLCJub3QiLCJleGlzdCIsInVuZGVmaW5lZCIsIlczQ19DQVBTIiwiZm9vIiwiYWx3YXlzTWF0Y2giLCJiYXNlQ2Fwc1dpdGhEZWZhdWx0IiwiT2JqZWN0IiwiYXNzaWduIiwidzNjQ2Fwc1dpdGhEZWZhdWx0IiwiXyIsImNsb25lRGVlcCIsImZvbzIiLCJlcnIiLCJoZWxsbyIsInByZXNlbmNlIiwiZXJyb3IiLCJtZXNzYWdlIiwibWF0Y2giLCJpc0Vycm9yIiwiYmUiLCJ0cnVlIiwidzNjQ2FwcyIsImZpcnN0TWF0Y2giLCJleHBlY3RlZFJlc3VsdCIsInBsYXRmb3JtTmFtZSIsInByb3BlcnR5TmFtZSIsImpzb253cENhcHMiLCJhdXRvbWF0aW9uTmFtZSIsImV4cGVjdGVkQ2FwcyIsImtleSIsInZhbHVlIiwidG9QYWlycyIsImVxbCIsInczY0NhcGFiaWxpdGllcyIsImNvbnN0cmFpbnRzIiwiZGV2aWNlTmFtZSIsInNvbWVDYXAiLCJicm93c2VyTmFtZSIsInNvbWVPdGhlckNhcCIsInlldEFub3RoZXJDYXAiLCJjYXBzIiwic2V0dGluZ3MiLCJzZXR0aW5nTmFtZSIsInNldHRpbmdOYW1lMiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBR0EsTUFBTUEsTUFBTSxHQUFHQyxjQUFLRCxNQUFMLEVBQWY7O0FBQ0FDLGNBQUtDLEdBQUwsQ0FBU0MsdUJBQVQ7O0FBRUFDLFFBQVEsQ0FBQyxPQUFELEVBQVUsWUFBWTtBQUM1QkEsRUFBQUEsUUFBUSxDQUFDLDJC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QUFDdEQsTUFBTCxDQUFZOEMsR0FBWixDQUFnQjtBQUNkUixRQUFBQSxZQUFZLEVBQUUsS0FEQTtBQUVkYSxRQUFBQSxXQUFXLEVBQUUsS0FGQztBQUdkLGdDQUF3QjtBQUhWLE9BQWhCO0FBS0QsS0FiQyxDQUFGO0FBY0E5QyxJQUFBQSxFQUFFLENBQUMsMENBQUQsRUFBNkMsWUFBWTtBQUN6RCxZQUFNaUQsSUFBSSxHQUFHLEVBQWI7QUFDQSxZQUFNQyxRQUFRLEdBQUcseUJBQWFELElBQWIsQ0FBakI7QUFDQUMsTUFBQUEsUUFBUSxDQUFDdkQsTUFBVCxDQUFnQjhDLEdBQWhCLENBQW9CLEVBQXBCO0FBQ0FRLE1BQUFBLElBQUksQ0FBQ3RELE1BQUwsQ0FBWThDLEdBQVosQ0FBZ0IsRUFBaEI7QUFDRCxLQUxDLENBQUY7QUFNRCxHQXJETyxDQUFSO0FBc0RELENBak9PLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCB7XG4gIHBhcnNlQ2Fwc0ZvcklubmVyRHJpdmVyLCBpbnNlcnRBcHBpdW1QcmVmaXhlcywgcHVsbFNldHRpbmdzIH0gZnJvbSAnLi4vbGliL3V0aWxzJztcbmltcG9ydCB7IEJBU0VfQ0FQUywgVzNDX0NBUFMgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuXG5jb25zdCBzaG91bGQgPSBjaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5kZXNjcmliZSgndXRpbHMnLCBmdW5jdGlvbiAoKSB7XG4gIGRlc2NyaWJlKCdwYXJzZUNhcHNGb3JJbm5lckRyaXZlcigpJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIEpTT05XUCBjYXBzIHVuY2hhbmdlZCBpZiBvbmx5IEpTT05XUCBjYXBzIHByb3ZpZGVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHtkZXNpcmVkQ2FwcywgcHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzLCBwcm9jZXNzZWRXM0NDYXBhYmlsaXRpZXMsIHByb3RvY29sfSA9IHBhcnNlQ2Fwc0ZvcklubmVyRHJpdmVyKEJBU0VfQ0FQUyk7XG4gICAgICBkZXNpcmVkQ2Fwcy5zaG91bGQuZGVlcC5lcXVhbChCQVNFX0NBUFMpO1xuICAgICAgcHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzLnNob3VsZC5kZWVwLmVxdWFsKEJBU0VfQ0FQUyk7XG4gICAgICBzaG91bGQubm90LmV4aXN0KHByb2Nlc3NlZFczQ0NhcGFiaWxpdGllcyk7XG4gICAgICBwcm90b2NvbC5zaG91bGQuZXF1YWwoJ01KU09OV1AnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBXM0MgY2FwcyB1bmNoYW5nZWQgaWYgb25seSBXM0MgY2FwcyB3ZXJlIHByb3ZpZGVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHtkZXNpcmVkQ2FwcywgcHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzLCBwcm9jZXNzZWRXM0NDYXBhYmlsaXRpZXMsIHByb3RvY29sfSA9IHBhcnNlQ2Fwc0ZvcklubmVyRHJpdmVyKHVuZGVmaW5lZCwgVzNDX0NBUFMpO1xuICAgICAgZGVzaXJlZENhcHMuc2hvdWxkLmRlZXAuZXF1YWwoQkFTRV9DQVBTKTtcbiAgICAgIHNob3VsZC5ub3QuZXhpc3QocHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzKTtcbiAgICAgIHByb2Nlc3NlZFczQ0NhcGFiaWxpdGllcy5zaG91bGQuZGVlcC5lcXVhbChXM0NfQ0FQUyk7XG4gICAgICBwcm90b2NvbC5zaG91bGQuZXF1YWwoJ1czQycpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIEpTT05XUCBhbmQgVzNDIGNhcHMgaWYgYm90aCB3ZXJlIHByb3ZpZGVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHtkZXNpcmVkQ2FwcywgcHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzLCBwcm9jZXNzZWRXM0NDYXBhYmlsaXRpZXMsIHByb3RvY29sfSA9IHBhcnNlQ2Fwc0ZvcklubmVyRHJpdmVyKEJBU0VfQ0FQUywgVzNDX0NBUFMpO1xuICAgICAgZGVzaXJlZENhcHMuc2hvdWxkLmRlZXAuZXF1YWwoQkFTRV9DQVBTKTtcbiAgICAgIHByb2Nlc3NlZEpzb253cENhcGFiaWxpdGllcy5zaG91bGQuZGVlcC5lcXVhbChCQVNFX0NBUFMpO1xuICAgICAgcHJvY2Vzc2VkVzNDQ2FwYWJpbGl0aWVzLnNob3VsZC5kZWVwLmVxdWFsKFczQ19DQVBTKTtcbiAgICAgIHByb3RvY29sLnNob3VsZC5lcXVhbCgnVzNDJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBpbmNsdWRlIGRlZmF1bHQgY2FwYWJpbGl0aWVzIGluIHJlc3VsdHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQge2Rlc2lyZWRDYXBzLCBwcm9jZXNzZWRKc29ud3BDYXBhYmlsaXRpZXMsIHByb2Nlc3NlZFczQ0NhcGFiaWxpdGllc30gPSBwYXJzZUNhcHNGb3JJbm5lckRyaXZlcihCQVNFX0NBUFMsIFczQ19DQVBTLCB7fSwge2ZvbzogJ2Jhcid9KTtcbiAgICAgIGRlc2lyZWRDYXBzLnNob3VsZC5kZWVwLmVxdWFsKHtmb286ICdiYXInLCAuLi5CQVNFX0NBUFN9KTtcbiAgICAgIHByb2Nlc3NlZEpzb253cENhcGFiaWxpdGllcy5zaG91bGQuZGVlcC5lcXVhbCh7Zm9vOiAnYmFyJywgLi4uQkFTRV9DQVBTfSk7XG4gICAgICBwcm9jZXNzZWRXM0NDYXBhYmlsaXRpZXMuYWx3YXlzTWF0Y2guc2hvdWxkLmRlZXAuZXF1YWwoeydhcHBpdW06Zm9vJzogJ2JhcicsIC4uLmluc2VydEFwcGl1bVByZWZpeGVzKEJBU0VfQ0FQUyl9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHJld3JpdGUgZGVmYXVsdCBjYXBhYmlsaXRpZXMgaW4gcmVzdWx0cycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGJhc2VDYXBzV2l0aERlZmF1bHQgPSBPYmplY3QuYXNzaWduKHt9LCBCQVNFX0NBUFMsIHtcbiAgICAgICAgZm9vOiAnYmF6JyxcbiAgICAgICAgJ2FwcGl1bTpmb28yJzogJ2JhejInLFxuICAgICAgfSk7XG4gICAgICBjb25zdCB3M2NDYXBzV2l0aERlZmF1bHQgPSBfLmNsb25lRGVlcChXM0NfQ0FQUyk7XG4gICAgICB3M2NDYXBzV2l0aERlZmF1bHQuYWx3YXlzTWF0Y2guZm9vID0gJ2Jheic7XG4gICAgICB3M2NDYXBzV2l0aERlZmF1bHQuYWx3YXlzTWF0Y2guZm9vMiA9ICdiYXoyJztcbiAgICAgIGxldCB7ZGVzaXJlZENhcHMsIHByb2Nlc3NlZEpzb253cENhcGFiaWxpdGllcywgcHJvY2Vzc2VkVzNDQ2FwYWJpbGl0aWVzfSA9IHBhcnNlQ2Fwc0ZvcklubmVyRHJpdmVyKGJhc2VDYXBzV2l0aERlZmF1bHQsIHczY0NhcHNXaXRoRGVmYXVsdCwge30sIHtcbiAgICAgICAgZm9vOiAnYmFyJyxcbiAgICAgICAgJ2FwcGl1bTpmb28yJzogJ2JhcjInLFxuICAgICAgfSk7XG4gICAgICBkZXNpcmVkQ2Fwcy5zaG91bGQuZGVlcC5lcXVhbCh7Zm9vOiAnYmF6JywgZm9vMjogJ2JhejInLCAuLi5CQVNFX0NBUFN9KTtcbiAgICAgIHByb2Nlc3NlZEpzb253cENhcGFiaWxpdGllcy5zaG91bGQuZGVlcC5lcXVhbCh7Zm9vOiAnYmF6JywgZm9vMjogJ2JhejInLCAuLi5CQVNFX0NBUFN9KTtcbiAgICAgIHByb2Nlc3NlZFczQ0NhcGFiaWxpdGllcy5hbHdheXNNYXRjaC5zaG91bGQuZGVlcC5lcXVhbCh7J2FwcGl1bTpmb28nOiAnYmF6JywgJ2FwcGl1bTpmb28yJzogJ2JhejInLCAuLi5pbnNlcnRBcHBpdW1QcmVmaXhlcyhCQVNFX0NBUFMpfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaWYgVzNDIGNhcHMgYXJlIG5vdCBwYXNzaW5nIGNvbnN0cmFpbnRzJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZXJyID0gcGFyc2VDYXBzRm9ySW5uZXJEcml2ZXIodW5kZWZpbmVkLCBXM0NfQ0FQUywge2hlbGxvOiB7cHJlc2VuY2U6IHRydWV9fSkuZXJyb3I7XG4gICAgICBlcnIubWVzc2FnZS5zaG91bGQubWF0Y2goLydoZWxsbycgY2FuJ3QgYmUgYmxhbmsvKTtcbiAgICAgIF8uaXNFcnJvcihlcnIpLnNob3VsZC5iZS50cnVlO1xuXG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBvbmx5IGFjY2VwdCBXM0MgY2FwcyB0aGF0IGhhdmUgcGFzc2luZyBjb25zdHJhaW50cycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCB3M2NDYXBzID0ge1xuICAgICAgICAuLi5XM0NfQ0FQUyxcbiAgICAgICAgZmlyc3RNYXRjaDogW1xuICAgICAgICAgIHtmb286ICdiYXInfSxcbiAgICAgICAgICB7aGVsbG86ICd3b3JsZCd9LFxuICAgICAgICBdLFxuICAgICAgfTtcbiAgICAgIGxldCB7ZGVzaXJlZENhcHMsIHByb2Nlc3NlZEpzb253cENhcGFiaWxpdGllcywgcHJvY2Vzc2VkVzNDQ2FwYWJpbGl0aWVzLCBwcm90b2NvbH0gPSBwYXJzZUNhcHNGb3JJbm5lckRyaXZlcihCQVNFX0NBUFMsIHczY0NhcHMsIHtoZWxsbzoge3ByZXNlbmNlOiB0cnVlfX0pO1xuICAgICAgY29uc3QgZXhwZWN0ZWRSZXN1bHQgPSB7aGVsbG86ICd3b3JsZCcsIC4uLkJBU0VfQ0FQU307XG4gICAgICBkZXNpcmVkQ2Fwcy5zaG91bGQuZGVlcC5lcXVhbChleHBlY3RlZFJlc3VsdCk7XG4gICAgICBwcm9jZXNzZWRKc29ud3BDYXBhYmlsaXRpZXMuc2hvdWxkLmRlZXAuZXF1YWwoey4uLkJBU0VfQ0FQU30pO1xuICAgICAgcHJvY2Vzc2VkVzNDQ2FwYWJpbGl0aWVzLmFsd2F5c01hdGNoLnNob3VsZC5kZWVwLmVxdWFsKGluc2VydEFwcGl1bVByZWZpeGVzKGV4cGVjdGVkUmVzdWx0KSk7XG4gICAgICBwcm90b2NvbC5zaG91bGQuZXF1YWwoJ1czQycpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgYWRkIGFwcGl1bSBwcmVmaXhlcyB0byBXM0MgY2FwcyB0aGF0IGFyZSBub3Qgc3RhbmRhcmQgaW4gVzNDJywgZnVuY3Rpb24gKCkge1xuICAgICAgcGFyc2VDYXBzRm9ySW5uZXJEcml2ZXIodW5kZWZpbmVkLCB7XG4gICAgICAgIGFsd2F5c01hdGNoOiB7XG4gICAgICAgICAgcGxhdGZvcm1OYW1lOiAnRmFrZScsXG4gICAgICAgICAgcHJvcGVydHlOYW1lOiAnUFJPUF9OQU1FJyxcbiAgICAgICAgfSxcbiAgICAgIH0pLnByb2Nlc3NlZFczQ0NhcGFiaWxpdGllcy5zaG91bGQuZGVlcC5lcXVhbCh7XG4gICAgICAgIGFsd2F5c01hdGNoOiB7XG4gICAgICAgICAgcGxhdGZvcm1OYW1lOiAnRmFrZScsXG4gICAgICAgICAgJ2FwcGl1bTpwcm9wZXJ0eU5hbWUnOiAnUFJPUF9OQU1FJyxcbiAgICAgICAgfSxcbiAgICAgICAgZmlyc3RNYXRjaDogW3t9XSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbWVyZ2UgZXh0cmFuZW91cyBNSlNPTldQIGNhcHMgaW50byBXM0MnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQganNvbndwQ2FwcyA9IHtcbiAgICAgICAgLi4uQkFTRV9DQVBTLFxuICAgICAgICBhdXRvbWF0aW9uTmFtZTogJ0Zha2UnLFxuICAgICAgfTtcbiAgICAgIGNvbnN0IHtkZXNpcmVkQ2FwcywgcHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzLCBwcm9jZXNzZWRXM0NDYXBhYmlsaXRpZXMsIHByb3RvY29sfSA9IHBhcnNlQ2Fwc0ZvcklubmVyRHJpdmVyKGpzb253cENhcHMsIHtcbiAgICAgICAgYWx3YXlzTWF0Y2g6IHtwbGF0Zm9ybU5hbWU6ICdGYWtlJywgcHJvcGVydHlOYW1lOiAnUFJPUF9OQU1FJ30sXG4gICAgICB9KTtcblxuICAgICAgLy8gV2UgZXhwZWN0IGEgY29tYm8gb2YganNvbndwIGNhcHMgYW5kIHczYyBwcm92aWRlZCBjYXBzIHdpdGggYGFwcGl1bTpgIHByZWZpeCBmb3Igbm9uLXN0YW5kYXJkIGNhcHNcbiAgICAgIGNvbnN0IGV4cGVjdGVkQ2FwcyA9IHt9O1xuXG4gICAgICBmb3IgKGxldCBba2V5LCB2YWx1ZV0gb2YgXy50b1BhaXJzKGpzb253cENhcHMpKSB7XG4gICAgICAgIGlmIChrZXkgIT09ICdwbGF0Zm9ybU5hbWUnKSB7XG4gICAgICAgICAgZXhwZWN0ZWRDYXBzW2BhcHBpdW06JHtrZXl9YF0gPSB2YWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBleHBlY3RlZENhcHNba2V5XSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBleHBlY3RlZENhcHNbJ2FwcGl1bTpwcm9wZXJ0eU5hbWUnXSA9ICdQUk9QX05BTUUnO1xuXG4gICAgICBwcm9jZXNzZWRXM0NDYXBhYmlsaXRpZXMuYWx3YXlzTWF0Y2guc2hvdWxkLmVxbChleHBlY3RlZENhcHMpO1xuICAgICAgZGVzaXJlZENhcHMuc2hvdWxkLmVxbCh7XG4gICAgICAgIC4uLmpzb253cENhcHMsXG4gICAgICAgIHByb3BlcnR5TmFtZTogJ1BST1BfTkFNRScsXG4gICAgICB9KTtcbiAgICAgIHByb2Nlc3NlZEpzb253cENhcGFiaWxpdGllcy5zaG91bGQuZXFsKGpzb253cENhcHMpO1xuICAgICAgcHJvdG9jb2wuc2hvdWxkLmVxdWFsKCdXM0MnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGZpeCBXM0MgY2FwcyBieSB1c2luZyBNSlNPTldQIGlmIGludmFsaWQgVzNDIGNhcHMgd2VyZSBwcm92aWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCB3M2NDYXBhYmlsaXRpZXMgPSB7XG4gICAgICAgIGFsd2F5c01hdGNoOiB7cGxhdGZvcm1OYW1lOiAnRmFrZScsIHByb3BlcnR5TmFtZTogJ1BST1BfTkFNRSd9LFxuICAgICAgfTtcbiAgICAgIGxldCBjb25zdHJhaW50cyA9IHtcbiAgICAgICAgZGV2aWNlTmFtZToge1xuICAgICAgICAgIHByZXNlbmNlOiB0cnVlLFxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgY29uc3Qge2Rlc2lyZWRDYXBzLCBwcm9jZXNzZWRKc29ud3BDYXBhYmlsaXRpZXMsIHByb2Nlc3NlZFczQ0NhcGFiaWxpdGllcywgcHJvdG9jb2x9ID0gcGFyc2VDYXBzRm9ySW5uZXJEcml2ZXIoey4uLkJBU0VfQ0FQU30sIHczY0NhcGFiaWxpdGllcywgY29uc3RyYWludHMpO1xuICAgICAgcHJvY2Vzc2VkVzNDQ2FwYWJpbGl0aWVzLnNob3VsZC5leGlzdDtcbiAgICAgIGRlc2lyZWRDYXBzLnNob3VsZC5lcWwoey4uLkJBU0VfQ0FQUywgcHJvcGVydHlOYW1lOiAnUFJPUF9OQU1FJ30pO1xuICAgICAgcHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzLnNob3VsZC5lcWwoQkFTRV9DQVBTKTtcbiAgICAgIHByb3RvY29sLnNob3VsZC5lcXVhbCgnVzNDJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnNlcnRBcHBpdW1QcmVmaXhlcygpJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgYXBwbHkgcHJlZml4ZXMgdG8gbm9uLXN0YW5kYXJkIGNhcGFiaWxpdGllcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGluc2VydEFwcGl1bVByZWZpeGVzKHtcbiAgICAgICAgc29tZUNhcDogJ3NvbWVDYXAnLFxuICAgICAgfSkuc2hvdWxkLmRlZXAuZXF1YWwoe1xuICAgICAgICAnYXBwaXVtOnNvbWVDYXAnOiAnc29tZUNhcCcsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG5vdCBhcHBseSBwcmVmaXhlcyB0byBzdGFuZGFyZCBjYXBhYmlsaXRpZXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpbnNlcnRBcHBpdW1QcmVmaXhlcyh7XG4gICAgICAgIGJyb3dzZXJOYW1lOiAnQnJvd3Nlck5hbWUnLFxuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdQbGF0Zm9ybU5hbWUnLFxuICAgICAgfSkuc2hvdWxkLmRlZXAuZXF1YWwoe1xuICAgICAgICBicm93c2VyTmFtZTogJ0Jyb3dzZXJOYW1lJyxcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnUGxhdGZvcm1OYW1lJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbm90IGFwcGx5IHByZWZpeGVzIHRvIGNhcGFiaWxpdGllcyB0aGF0IGFscmVhZHkgaGF2ZSBhIHByZWZpeCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGluc2VydEFwcGl1bVByZWZpeGVzKHtcbiAgICAgICAgJ2FwcGl1bTpzb21lQ2FwJzogJ3NvbWVDYXAnLFxuICAgICAgICAnbW96OnNvbWVPdGhlckNhcCc6ICdzb21lT3RoZXJDYXAnLFxuICAgICAgfSkuc2hvdWxkLmRlZXAuZXF1YWwoe1xuICAgICAgICAnYXBwaXVtOnNvbWVDYXAnOiAnc29tZUNhcCcsXG4gICAgICAgICdtb3o6c29tZU90aGVyQ2FwJzogJ3NvbWVPdGhlckNhcCcsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGFwcGx5IHByZWZpeGVzIHRvIG5vbi1wcmVmaXhlZCwgbm9uLXN0YW5kYXJkIGNhcGFiaWxpdGllczsgc2hvdWxkIG5vdCBhcHBseSBwcmVmaXhlcyB0byBhbnkgb3RoZXIgY2FwYWJpbGl0aWVzJywgZnVuY3Rpb24gKCkge1xuICAgICAgaW5zZXJ0QXBwaXVtUHJlZml4ZXMoe1xuICAgICAgICAnYXBwaXVtOnNvbWVDYXAnOiAnc29tZUNhcCcsXG4gICAgICAgICdtb3o6c29tZU90aGVyQ2FwJzogJ3NvbWVPdGhlckNhcCcsXG4gICAgICAgIGJyb3dzZXJOYW1lOiAnQnJvd3Nlck5hbWUnLFxuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdQbGF0Zm9ybU5hbWUnLFxuICAgICAgICBzb21lT3RoZXJDYXA6ICdzb21lT3RoZXJDYXAnLFxuICAgICAgICB5ZXRBbm90aGVyQ2FwOiAneWV0QW5vdGhlckNhcCcsXG4gICAgICB9KS5zaG91bGQuZGVlcC5lcXVhbCh7XG4gICAgICAgICdhcHBpdW06c29tZUNhcCc6ICdzb21lQ2FwJyxcbiAgICAgICAgJ21vejpzb21lT3RoZXJDYXAnOiAnc29tZU90aGVyQ2FwJyxcbiAgICAgICAgYnJvd3Nlck5hbWU6ICdCcm93c2VyTmFtZScsXG4gICAgICAgIHBsYXRmb3JtTmFtZTogJ1BsYXRmb3JtTmFtZScsXG4gICAgICAgICdhcHBpdW06c29tZU90aGVyQ2FwJzogJ3NvbWVPdGhlckNhcCcsXG4gICAgICAgICdhcHBpdW06eWV0QW5vdGhlckNhcCc6ICd5ZXRBbm90aGVyQ2FwJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncHVsbFNldHRpbmdzKCknLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBwdWxsIHNldHRpbmdzIGZyb20gY2FwcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGNhcHMgPSB7XG4gICAgICAgIHBsYXRmb3JtTmFtZTogJ2ZvbycsXG4gICAgICAgIGJyb3dzZXJOYW1lOiAnYmFyJyxcbiAgICAgICAgJ3NldHRpbmdzW3NldHRpbmdOYW1lXSc6ICdiYXonLFxuICAgICAgICAnc2V0dGluZ3Nbc2V0dGluZ05hbWUyXSc6ICdiYXoyJyxcbiAgICAgIH07XG4gICAgICBjb25zdCBzZXR0aW5ncyA9IHB1bGxTZXR0aW5ncyhjYXBzKTtcbiAgICAgIHNldHRpbmdzLnNob3VsZC5lcWwoe1xuICAgICAgICBzZXR0aW5nTmFtZTogJ2JheicsXG4gICAgICAgIHNldHRpbmdOYW1lMjogJ2JhejInLFxuICAgICAgfSk7XG4gICAgICBjYXBzLnNob3VsZC5lcWwoe1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdmb28nLFxuICAgICAgICBicm93c2VyTmFtZTogJ2JhcicsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHB1bGwgc2V0dGluZ3MgZGljdCBpZiBvYmplY3QgdmFsdWVzIGFyZSBwcmVzZW50IGluIGNhcHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdmb28nLFxuICAgICAgICBicm93c2VyTmFtZTogJ2JhcicsXG4gICAgICAgICdzZXR0aW5nc1tzZXR0aW5nTmFtZV0nOiB7a2V5OiAnYmF6J30sXG4gICAgICB9O1xuICAgICAgY29uc3Qgc2V0dGluZ3MgPSBwdWxsU2V0dGluZ3MoY2Fwcyk7XG4gICAgICBzZXR0aW5ncy5zaG91bGQuZXFsKHtcbiAgICAgICAgc2V0dGluZ05hbWU6IHtrZXk6ICdiYXonfSxcbiAgICAgIH0pO1xuICAgICAgY2Fwcy5zaG91bGQuZXFsKHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnZm9vJyxcbiAgICAgICAgYnJvd3Nlck5hbWU6ICdiYXInLFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBwdWxsIGVtcHR5IGRpY3QgaWYgbm8gc2V0dGluZ3MgYXJlIHByZXNlbnQgaW4gY2FwcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGNhcHMgPSB7XG4gICAgICAgIHBsYXRmb3JtTmFtZTogJ2ZvbycsXG4gICAgICAgIGJyb3dzZXJOYW1lOiAnYmFyJyxcbiAgICAgICAgJ3NldHRpbmdbc2V0dGluZ05hbWVdJzogJ2JheicsXG4gICAgICB9O1xuICAgICAgY29uc3Qgc2V0dGluZ3MgPSBwdWxsU2V0dGluZ3MoY2Fwcyk7XG4gICAgICBzZXR0aW5ncy5zaG91bGQuZXFsKHt9KTtcbiAgICAgIGNhcHMuc2hvdWxkLmVxbCh7XG4gICAgICAgIHBsYXRmb3JtTmFtZTogJ2ZvbycsXG4gICAgICAgIGJyb3dzZXJOYW1lOiAnYmFyJyxcbiAgICAgICAgJ3NldHRpbmdbc2V0dGluZ05hbWVdJzogJ2JheicsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHB1bGwgZW1wdHkgZGljdCBpZiBjYXBzIGFyZSBlbXB0eScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGNhcHMgPSB7fTtcbiAgICAgIGNvbnN0IHNldHRpbmdzID0gcHVsbFNldHRpbmdzKGNhcHMpO1xuICAgICAgc2V0dGluZ3Muc2hvdWxkLmVxbCh7fSk7XG4gICAgICBjYXBzLnNob3VsZC5lcWwoe30pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sImZpbGUiOiJ0ZXN0L3V0aWxzLXNwZWNzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
